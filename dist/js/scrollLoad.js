"use strict";var _createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t(require("jquery")):e.ScrollLoad=t(e.jQuery)}(window,function(e){return function(){function t(o){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,t);var n=this,r={isScrollUp:!1,scrollUpTexts:["下拉更新数据","松开更新数据","正在获取最新数据...","已经是最新的了！"],scrollDownTexts:["上拉加载更多","松开更新数据","数据加载中...","已经没有更多数据了！"],isLazyLoad:!1,lazyLoadClass:".lazyload",iScrollOptions:{scrollbars:!0,probeType:1,shrinkScrollbars:"scale",click:!0,taps:!0},onScrollDownEnd:function(e,t){},onScrollUpEnd:function(e,t){}};for(var s in n.elem=o,n.curUpPage=1,n.curDownPage=1,n.options=i,n.prevUpdataTime=(new Date).getTime(),r)if(void 0===n.options[s])n.options[s]=r[s];else if("object"===_typeof(n.options[s]))for(var l in r[s])if(void 0===n.options[s][l])n.options[s][l]=r[s][l];else if("object"===_typeof(n.options[s][l]))for(var a in r[s][l])void 0===n.options[s][l][a]&&(n.options[s][l][a]=r[s][l][a]);e(document).on("touchmove",function(e){e.preventDefault()});var c=e(n.elem).children(".scroller");n.$header=c.children(".scroll-header"),n.$footer=c.children(".scroll-footer"),n.$list=c.children("ul"),window.addEventListener("load",function(){setTimeout(function(){n.ms=new IScroll(n.elem,n.options.iScrollOptions),n.init()},200)})}return _createClass(t,[{key:"getTimeDifference",value:function(e){var t=((new Date).getTime()-e)/1e3;return t>=0&&t<60?"刚刚更新":t>=60&&t<3600?parseInt(t/60)+"分钟前":t>=3600&&t<86400?parseInt(t/3600)+"小时前":t>=86400&&t<345600?parseInt(t/86400)+"天前":new Date(e).toLocaleString().replace(/:\d{1,2}$/," ")}},{key:"throttle",value:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=void 0,n=void 0,r=void 0,s=null,l=0,a=function(){l=!1===o.leading?0:(new Date).getTime(),s=null,r=e.apply(i,n),s||(i=n=null)};return function(){var c=(new Date).getTime();l||!1!==o.leading||(l=c);var h=t-(c-l);return i=this,n=arguments,h<=0||h>t?(s&&(clearTimeout(s),s=null),l=c,r=e.apply(i,n),s||(i=n=null)):s||!1===o.trailing||(s=setTimeout(a,h)),r}}},{key:"createObserver",value:function(e,t){var o=new IntersectionObserver(function(e){e.forEach(function(e){"function"==typeof t&&t(e)})},{root:document.querySelector(this.elem),threshold:[0,1]});document.querySelectorAll(e).forEach(function(e){o.observe(e)})}},{key:"lazyload",value:function(t){if(!this.options.isLazyLoad)return!1;var o=this.options.lazyLoadClass;"function"==typeof window.IntersectionObserver?this.createObserver(o,function(e){if(e.intersectionRatio>0){var t=e.target.getAttribute("data-src");e.target.src=t}}):e(o).each(function(){var o=Math.round(e(this).position().top);if(Math.abs(t)+e(window).height()>=o){var i=e(this).attr("data-src");e(this).prop("src",i)}})}},{key:"init",value:function(){var e=this,t=this.options,o=t.isScrollUp?Math.round(this.$header.innerHeight()):0;Math.round(this.$footer.innerHeight());if(this.lazyload(this.ms.y),this.ms.scroller.clientHeight>this.ms.wrapperHeight){if(t.isScrollUp){this.ms.scrollTo(0,-o);var i=setTimeout(function(){e.ms.refresh(),i&&clearTimeout(i)},0);this.$header.show(),this.scrollUp()}else{this.$header.hide(),this.ms.scrollTo(0,0);var n=setTimeout(function(){e.ms.refresh(),n&&clearTimeout(n)},0)}this.$footer.show(),this.scrollDown()}else{this.$header.hide(),this.$footer.hide(),this.ms.scrollTo(0,0);var r=setTimeout(function(){e.ms.refresh(),r&&clearTimeout(r)},0)}}},{key:"scrollUp",value:function(){var e=this;this.ms.on("scrollStart",function(){e.scrollUpStart()}),this.ms.on("scroll",this.throttle(function(){e.scrollingUp(),e.lazyload(e.ms.y)},300,{leading:!1})),this.ms.on("scrollEnd",this.throttle(function(){e.scrollUpEnd()},500,{leading:!1}))}},{key:"scrollUpStart",value:function(){var e=this.$header.children(".load-text"),t=this.$header.children(".load-time").children(".state"),o=this.getTimeDifference(this.prevUpdataTime);t.text(o),e.prop("class","load-text"),e.children(".text").text(this.options.scrollUpTexts[0])}},{key:"scrollingUp",value:function(){var e=this.ms.y,t=this.$header.children(".load-text");e>0&&(t.addClass("ready"),t.children(".text").text(this.options.scrollUpTexts[1]))}},{key:"scrollUpEnd",value:function(){var e=this,t=this.$header.children(".load-text"),o=this.$header.innerHeight(),i=this.ms.y,n=this.options,r=this,s={end:function(){var e=setTimeout(function(){t.removeClass("ready").addClass("finish"),t.children(".text").text(n.scrollUpTexts[3]),clearTimeout(e)},300)},loading:function(){var e=setTimeout(function(){r.ms.refresh(),r.lazyload(r.ms.y),clearTimeout(e)},0)}};if(0===i){t.removeClass("ready").addClass("loading"),t.children(".text").text(n.scrollUpTexts[2]),this.curUpPage++;var l=setTimeout(function(){t.removeClass("loading"),t.children(".text").text(n.scrollUpTexts[0]),clearTimeout(l)},300),a=setTimeout(function(){e.ms.scrollTo(0,-o,300,IScroll.utils.ease.quadratic),e.prevUpdataTime<(new Date).getTime()&&(e.prevUpdataTime=(new Date).getTime()),clearTimeout(a)},500);n.onScrollUpEnd(s,this.curUpPage)}}},{key:"scrollDown",value:function(){var e=this;this.ms.on("scroll",this.throttle(function(){e.scrollingDown(),e.lazyload(e.ms.y)},500,{leading:!1})),this.ms.on("scrollEnd",this.throttle(function(){e.scrollDownEnd()},500,{leading:!1}))}},{key:"scrollingDown",value:function(){var e=this.$footer.children(".load-text"),t=this.options;if("function"==typeof window.IntersectionObserver)this.createObserver(".scroll-footer",function(o){o.intersectionRatio>0&&(e.prop("class","load-text"),e.children(".text").text(t.scrollDownTexts[0])),o.intersectionRatio>=1&&(e.addClass("ready"),e.children(".text").text(t.scrollDownTexts[1]))});else{var o=this.$footer.offset().top,i=this.$footer.innerHeight(),n=Math.abs(this.ms.y),r=this.ms.wrapperHeight;if(n+r>=o&&(e.prop("class","load-text"),e.children(".text").text(t.scrollDownTexts[0])),n+r>=o+i)var s=setTimeout(function(){e.addClass("ready"),e.children(".text").text(t.scrollDownTexts[1]),clearTimeout(s)},0)}}},{key:"scrollDownEnd",value:function(){var e=this.$footer.children(".load-text"),t=this.ms.y,o=this.options,i=this,n={end:function(){var t=setTimeout(function(){e.removeClass("ready").addClass("finish"),e.children(".text").text(o.scrollDownTexts[3]),i.scrollDown=null,clearTimeout(t)},300)},loading:function(){var e=setTimeout(function(){i.ms.refresh(),i.lazyload(i.ms.y),clearTimeout(e)},0)}};if(t<=this.ms.wrapperHeight-this.ms.scrollerHeight){e.removeClass("ready").addClass("loading"),e.children(".text").text(o.scrollDownTexts[2]),this.curDownPage++;var r=setTimeout(function(){e.removeClass("loading"),e.children(".text").text(o.scrollDownTexts[0]),clearTimeout(r)},300);o.onScrollDownEnd(n,this.curDownPage)}}}]),t}()});
//# sourceMappingURL=scrollLoad.js.map
